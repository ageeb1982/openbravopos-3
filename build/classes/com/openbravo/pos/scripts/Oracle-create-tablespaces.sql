spool Oracle-create-tablespaces.log

SELECT TO_CHAR(SYSDATE,'DD-MM-YYYY hh24:mi:ss') AS STARTS_SCRIPT FROM DUAL;
SELECT TRIM(0 FROM SYS_CONTEXT('USERENV','INSTANCE_NAME')) AS INSTANCE_NAME, TRIM(0 FROM SYS_CONTEXT('USERENV','CURRENT_USER')) AS CURRENT_USER FROM DUAL;

SET SERVEROUTPUT ON;
SET DEFINE OFF;

DECLARE
  VCREATED NUMERIC(1);
  VIDSTEP  NUMBER(14,0);
  VDESCRIPTION VARCHAR2(50 CHAR);
  PATH_DIR    VARCHAR2(1024 CHAR);
  DATA_FILE   VARCHAR2(1024 CHAR);
BEGIN
  -- STARTS
  SELECT '/oraclexe/app/oracle/oradata/XE/' INTO PATH_DIR FROM DUAL;
  --SELECT '/usr/lib/oracle/xe/oradata/XE/' INTO PATH_DIR FROM DUAL;
  
  SELECT 101 INTO VIDSTEP FROM DUAL;
  SELECT 'TABLESPACE OB_DATA' INTO VDESCRIPTION FROM DUAL;
  DBMS_OUTPUT.PUT_LINE('EXECUTING STEP ' || VIDSTEP || ' - ' || VDESCRIPTION);
  SELECT NVL(COUNT(*), 0) INTO VCREATED FROM USER_TABLESPACES WHERE TABLESPACE_NAME LIKE 'OB_DATA';
  IF (VCREATED = 0) THEN
    SELECT CONCAT(PATH_DIR, 'OB_DATA_01.dbf''') INTO DATA_FILE FROM DUAL;
    EXECUTE IMMEDIATE 'CREATE TABLESPACE OB_DATA DATAFILE ''' || DATA_FILE || ' SIZE 1G EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
  ELSE
    DBMS_OUTPUT.PUT_LINE('STEP ' || VIDSTEP || ' NOT EXECUTED - ' || VDESCRIPTION);
  END IF;
  
  SELECT 102 INTO VIDSTEP FROM DUAL;
  SELECT 'TABLESPACE OB_INDEX' INTO VDESCRIPTION FROM DUAL;
  DBMS_OUTPUT.PUT_LINE('EXECUTING STEP ' || VIDSTEP || ' - ' || VDESCRIPTION);
  SELECT NVL(COUNT(*), 0) INTO VCREATED FROM USER_TABLESPACES WHERE TABLESPACE_NAME LIKE 'OB_INDEX';
  IF (VCREATED = 0) THEN
    SELECT CONCAT(PATH_DIR, 'OB_INDEX_01.dbf''') INTO DATA_FILE FROM DUAL;
    EXECUTE IMMEDIATE 'CREATE TABLESPACE OB_INDEX DATAFILE ''' || DATA_FILE || ' SIZE 512M EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
  ELSE
    DBMS_OUTPUT.PUT_LINE('STEP ' || VIDSTEP || ' NOT EXECUTED - ' || VDESCRIPTION);
  END IF;
  
  
  SELECT 103 INTO VIDSTEP FROM DUAL;
  SELECT 'TABLESPACE OB_DATA_HISTORIC' INTO VDESCRIPTION FROM DUAL;
  DBMS_OUTPUT.PUT_LINE('EXECUTING STEP ' || VIDSTEP || ' - ' || VDESCRIPTION);
  SELECT NVL(COUNT(*), 0) INTO VCREATED FROM USER_TABLESPACES WHERE TABLESPACE_NAME LIKE 'OB_DATA_HISTORIC';
  IF (VCREATED = 0) THEN
    SELECT CONCAT(PATH_DIR, 'OB_DATA_HISTORIC_01.dbf''') INTO DATA_FILE FROM DUAL;
    EXECUTE IMMEDIATE 'CREATE TABLESPACE OB_DATA_HISTORIC DATAFILE ''' || DATA_FILE || ' SIZE 1G EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
  ELSE
    DBMS_OUTPUT.PUT_LINE('STEP ' || VIDSTEP || ' NOT EXECUTED - ' || VDESCRIPTION);
  END IF;
  
  SELECT 104 INTO VIDSTEP FROM DUAL;
  SELECT 'TABLESPACE OB_INDEX_HISTORIC' INTO VDESCRIPTION FROM DUAL;
  DBMS_OUTPUT.PUT_LINE('EXECUTING STEP ' || VIDSTEP || ' - ' || VDESCRIPTION);
  SELECT NVL(COUNT(*), 0) INTO VCREATED FROM USER_TABLESPACES WHERE TABLESPACE_NAME LIKE 'OB_INDEX_HISTORIC';
  IF (VCREATED = 0) THEN
    SELECT CONCAT(PATH_DIR, 'OB_INDEX_HISTORIC_01.dbf''') INTO DATA_FILE FROM DUAL;
    EXECUTE IMMEDIATE 'CREATE TABLESPACE OB_INDEX_HISTORIC DATAFILE ''' || DATA_FILE || ' SIZE 512M EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
  ELSE
    DBMS_OUTPUT.PUT_LINE('STEP ' || VIDSTEP || ' NOT EXECUTED - ' || VDESCRIPTION);
  END IF;

  -- PORTAL

  SELECT 201 INTO VIDSTEP FROM DUAL;
  SELECT 'TABLESPACE PO_DATA' INTO VDESCRIPTION FROM DUAL;
  DBMS_OUTPUT.PUT_LINE('EXECUTING STEP ' || VIDSTEP || ' - ' || VDESCRIPTION);
  SELECT NVL(COUNT(*), 0) INTO VCREATED FROM USER_TABLESPACES WHERE TABLESPACE_NAME LIKE 'PO_DATA';
  IF (VCREATED = 0) THEN
    SELECT CONCAT(PATH_DIR, 'PO_DATA_01.dbf''') INTO DATA_FILE FROM DUAL;
    EXECUTE IMMEDIATE 'CREATE TABLESPACE PO_DATA DATAFILE ''' || DATA_FILE || ' SIZE 1G EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
  ELSE
    DBMS_OUTPUT.PUT_LINE('STEP ' || VIDSTEP || ' NOT EXECUTED - ' || VDESCRIPTION);
  END IF;
  
  SELECT 202 INTO VIDSTEP FROM DUAL;
  SELECT 'TABLESPACE PO_INDEX' INTO VDESCRIPTION FROM DUAL;
  DBMS_OUTPUT.PUT_LINE('EXECUTING STEP ' || VIDSTEP || ' - ' || VDESCRIPTION);
  SELECT NVL(COUNT(*), 0) INTO VCREATED FROM USER_TABLESPACES WHERE TABLESPACE_NAME LIKE 'PO_INDEX';
  IF (VCREATED = 0) THEN
    SELECT CONCAT(PATH_DIR, 'PO_INDEX_01.dbf''') INTO DATA_FILE FROM DUAL;
    EXECUTE IMMEDIATE 'CREATE TABLESPACE PO_INDEX DATAFILE ''' || DATA_FILE || ' SIZE 512M EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
  ELSE
    DBMS_OUTPUT.PUT_LINE('STEP ' || VIDSTEP || ' NOT EXECUTED - ' || VDESCRIPTION);
  END IF;
  
  
  SELECT 203 INTO VIDSTEP FROM DUAL;
  SELECT 'TABLESPACE PO_DATA_HISTORIC' INTO VDESCRIPTION FROM DUAL;
  DBMS_OUTPUT.PUT_LINE('EXECUTING STEP ' || VIDSTEP || ' - ' || VDESCRIPTION);
  SELECT NVL(COUNT(*), 0) INTO VCREATED FROM USER_TABLESPACES WHERE TABLESPACE_NAME LIKE 'PO_DATA_HISTORIC';
  IF (VCREATED = 0) THEN
    SELECT CONCAT(PATH_DIR, 'PO_DATA_HISTORIC_01.dbf''') INTO DATA_FILE FROM DUAL;
    EXECUTE IMMEDIATE 'CREATE TABLESPACE PO_DATA_HISTORIC DATAFILE ''' || DATA_FILE || ' SIZE 1G EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
  ELSE
    DBMS_OUTPUT.PUT_LINE('STEP ' || VIDSTEP || ' NOT EXECUTED - ' || VDESCRIPTION);
  END IF;
  
  SELECT 204 INTO VIDSTEP FROM DUAL;
  SELECT 'TABLESPACE PO_INDEX_HISTORIC' INTO VDESCRIPTION FROM DUAL;
  DBMS_OUTPUT.PUT_LINE('EXECUTING STEP ' || VIDSTEP || ' - ' || VDESCRIPTION);
  SELECT NVL(COUNT(*), 0) INTO VCREATED FROM USER_TABLESPACES WHERE TABLESPACE_NAME LIKE 'PO_INDEX_HISTORIC';
  IF (VCREATED = 0) THEN
    SELECT CONCAT(PATH_DIR, 'PO_INDEX_HISTORIC_01.dbf''') INTO DATA_FILE FROM DUAL;
    EXECUTE IMMEDIATE 'CREATE TABLESPACE PO_INDEX_HISTORIC DATAFILE ''' || DATA_FILE || ' SIZE 512M EXTENT MANAGEMENT LOCAL AUTOALLOCATE SEGMENT SPACE MANAGEMENT AUTO';
  ELSE
    DBMS_OUTPUT.PUT_LINE('STEP ' || VIDSTEP || ' NOT EXECUTED - ' || VDESCRIPTION);
  END IF;
  
  -- ENDS
END;
/

SELECT TO_CHAR(SYSDATE,'DD-MM-YYYY hh24:mi:ss') AS ENDS_SCRIPT FROM DUAL;

spool off;
quit
/
